# WEB-31 Долматов Фёдор Highload
## [ChatGPT](https://chatgpt.com)

## 1. Тема и целевая аудитория
### Описание
  - ChatGPT - это AI-чатбот для общения, поиска информации, решения задач с помощью генеративных LLM.
### Целевая аудитория
  ChatGPT имеет ~ 121.3 MAU, наибольшее число пользователей находится в Индии и США[1].
  - Местоположение
    | Страна  | Процент пользователей |
    | --- | --- |
    | Индия | 15.26% |
    | США | 14.43% |
    | Великобритания | 4.67% |
    | Бразилия | 4.62% |
    | Другие страны  | 61.02% |
  - Возраст
    | Возраст  | Процент пользователей |
    | --- | --- |
    | 18-24 | 23.19% |
    | 25-34 | 33.95% |
    | 35-44 | 20.65% |
    | 45-54 | 12.27% |
    | 55-64 | 6.45% |
    | 65+  | 3.49% |
### MVP функционал
  - Регистрация, авторизация
  - Обучение модели / разметка данных
  - Обработка текстовых запросов моделью
  - Система оценки ответов
  - История чатов
  - Обработка вложений моделью
### Ключевые продуктовые решения
  - Возможность обращаться к сторонним сервисам с помощью модели
  - Дообучение модели (на основе фидбека)
  - Монетизация (доступ к более новым версиям модели)
## 2. Расчёт нагрузки
### Продуктовые метрики [2]:
  | Метрика  | Значение |
  | --- | --- |
  | MAU | > 100 млн. |
  | DAU | ~ 9 млн. |
  - Поскольку точные данные отсутствуют, расчет DAU был выполнен на основе предположения, что каждый пользователь активен 10-15 (~13) дней в месяц, при общем количестве ~121 млн MAU.
- Средний размер хранилища пользователя:
  | Данные  | Объем |
  | --- | --- |
  | История чатов | ((75 * n + (225 + 1) * m) * k) Б  |
  | Медиафайлы | (0,5 * i * k) МБ |
  | Настройки персонализации и аккаунта | 1 МБ |
  - Средний размер вопроса от пользователя ~ 10 слов[3] (50 символов) = 50 - 100 Б (В зависимости от языка), в среднем 75 Б
  - Средний размер медиафайла при запросе ~ 0,5 МБ
  - Средний размер ответа модели ~ 30 слов[3] (150 символов) = 150 - 300 Б (В зависимости от языка), в среднем 225 Б + 1 Б на информацию об оценке ответа
  - Учитывая, что в одном чате может храниться несколько сообщений, как от пользователя, так и от модели, то необходимо умножить объемы, занимаемые ими, на соответствующие коэффициенты: n - количество сообщений от пользователя, m - количество ответов от модели, k - количество чатов / год.
  - Аналогично с медиафайлами, которых в одном чате в среднем i штук.
  - В среднем n = m = 6 (на каждый запрос один ответ), k = 156 (13 дней в месяц / год), i = 0,25
  - После рассчета получаем в среднем на одного пользователя / год:
    | Данные  | Объем |
    | --- | --- |
    | История чатов | 282 КБ |
    | Медиафайлы | 20 МБ |
    | Настройки персонализации и аккаунта | 1 МБ |
- Средний размер хранилища модели
  | Данные  | Объем |
  | --- | --- |
  | Обученная модель | > 500 ГБ |
  | Данные для обучения | > 700 ГБ |
  | Данные для дообучения | > 10 ГБ/мес |
- Среднее количество действий пользователя по MVP:
  | Действие  | Количество в день на одного пользователя (в среднем) |
  | --- | --- |
  | Регистрация | 0,0027 (1 / год) |
  | Авторизация | 0,033 (1 / месяц) |
  | Открытие страницы чата | 1 |
  | Отправка текстового запроса для модели | 1 |
  | Отправка медиа-запроса для модели | 0,25 |
  | Отправка оценки на ответ модели | 0,033 |
### Технические метрики
- Хранилище:
  - Расчет объема хранилища на n лет:
    - Данные для дообучения ~ 24 * 10 ГБ ~ 240 ГБ
    - Модель и исходные данные для ее обучения ~ 1,2 ТБ
    - При линейно растущем числе пользователей (10% / год) объем данных (282 КБ + 20 МБ + 1 МБ) ~ 21.3 МБ нужно умножить на 121 * 10 ^ (1 - n) * (11 ^ n - 10 ^ n) // хранить данные для 121 млн пользователей за n лет, 121 * 1,1 за n - 1 лет и т.д.
    - Для n = 2 получим (21,3 * (121 + 121 * 1,1) * 10 ^ 6) МБ + 1,44 ТБ ~ **5,41 ПБ**
- RPS = DAU / (24 * 60 * 60) * Кол-во действий в среднем на пользователя
- RPS (пик ~ 1.5х нагрузка (предположительно)):
  | Действие  | RPS | RPS (пик) |
  | --- | --- | --- |
  | Регистрация | 0,28 | 0,42 |
  | Авторизация | 3,44 | 5,16 |
  | Открытие страницы чата | 104,2 | 156,3 |
  | Отправка текстового запроса для модели | 104,2 | 156,3 |
  | Отправка медиа-запроса для модели | 26 | 39,1 |
  | Отправка оценки на ответ модели | 3,44 | 5,16 |
- Сетевой трафик:
  - Основной трафик приходится на открытие страницы чата, отправку текстового/медиа-запроса модели:
  - Открытие чата: RPS[Открытие чата] * (1,8 КБ + 0.5 МБ) ~ 52,3 МБ/c ~ 438.7 Мбит/c // в случае, если в чате уже есть и среднее число сообщений и медиа-файлы
  - Отправка текстового запроса: RPS[Открытие чата] * (75 Б) ~ 7,8 КБ/c ~ 62.4 Кбит/c
  - Отправка медиа-запроса: RPS[Открытие чата] * (0.5 МБ) ~ 52,1 МБ/c ~ 437 Мбит/c
  #### В пике:
  - Открытие чата: 78,45 МБ/c ~ 658 Мбит/c
  - Отправка текстового запроса: 11,7 КБ/c ~ 93,6 Кбит/c
  - Отправка медиа-запроса: 78,15 МБ/c ~ 655,6 Мбит/c
  #### Потребление трафика за сутки:
  - Открытие чата: ~ 4,5162 ТБ
  - Отправка текстового запроса: ~ 675 МБ
  - Отправка медиа-запроса: ~ 4,5 ТБ
### Список источников
1. [SimilarWEB](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/overview/website-performance/*/999/1m?webSource=Total&key=chat.openai.com)
2. [ExplodingTopics](https://explodingtopics.com/blog/chatgpt-users)
3. [InvestingInTheWEB](https://investingintheweb.com/education/chatgpt-statistics/)
